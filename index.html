<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minha Agenda</title>
  
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f9; margin: 0; padding: 20px; }
    h1 { color: #333; text-align: center; }
    
    /* Bot√µes e Filtros */
    .controles { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    button { padding: 10px 15px; border: none; border-radius: 20px; background-color: #007bff; color: white; cursor: pointer; font-weight: bold; transition: 0.3s; }
    button:hover { background-color: #0056b3; }
    .btn-config { background-color: #6c757d; }
    .btn-config:hover { background-color: #5a6268; }

    /* Modal de Configura√ß√µes */
    .modal { display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
    .modal-content { background-color: #fff; margin: 10% auto; padding: 20px; border-radius: 10px; width: 90%; max-width: 500px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
    .close-btn { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
    .close-btn:hover { color: black; }

    /* Abas do Modal */
    .tabs { display: flex; border-bottom: 2px solid #ccc; margin-bottom: 15px; }
    .tablink { background-color: transparent; color: #333; border-radius: 0; width: 50%; padding: 10px; font-size: 16px; border-bottom: 3px solid transparent; }
    .tablink:hover { background-color: #f1f1f1; }
    .tablink.active { border-bottom: 3px solid #007bff; color: #007bff; }
    .tabcontent { display: none; animation: fadeIn 0.3s; }
    @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }

    /* Inputs e Lista */
    input[type="text"], input[type="number"], input[type="date"] { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
    .lista-tarefas { list-style-type: none; padding: 0; }
    .lista-tarefas li { background: #fff; margin: 5px 0; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; justify-content: space-between; }
  </style>

  <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-messaging-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore-compat.js"></script>
</head>
<body>

  <h1>Minha Agenda</h1>

  <div class="controles">
    <button onclick="carregarTarefas('hoje')">Hoje</button>
    <button onclick="carregarTarefas('semana')">Esta Semana</button>
    <button onclick="abrirModalConfig()" class="btn-config">‚öôÔ∏è Configura√ß√µes</button>
  </div>

  <ul id="listaTarefas" class="lista-tarefas">
    </ul>

  <div id="modalConfiguracoes" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="fecharModalConfig()">&times;</span>
      <h2>Configura√ß√µes</h2>
      
      <div class="tabs">
        <button class="tablink active" onclick="abrirAba(event, 'abaAlarme')">üîî Alarmes</button>
        <button class="tablink" onclick="abrirAba(event, 'abaCategorias')">üìÇ Categorias</button>
      </div>

      <div id="abaAlarme" class="tabcontent" style="display: block;">
        <label for="tempoAntecedencia">Avisar com anteced√™ncia (minutos):</label>
        <input type="number" id="tempoAntecedencia" value="10">
        <br><br>
        <button onclick="solicitarPermissaoNotificacao()">Ativar Notifica√ß√µes Push</button>
      </div>

      <div id="abaCategorias" class="tabcontent">
        <label for="novaCategoria">Nova Categoria:</label>
        <input type="text" id="novaCategoria" placeholder="Ex: Trabalho, Pessoal...">
        <button onclick="adicionarCategoria()">Adicionar</button>
        <ul id="listaCategoriasModal" class="lista-tarefas"></ul>
      </div>
    </div>
  </div>

  <script>
    // 1. INICIALIZA√á√ÉO DO FIREBASE (Coloque suas credenciais aqui!)
    const firebaseConfig = {
      apiKey: "AIzaSyAEQeIKc1MCrV8BJr0CH_mfjwCp1YiRC8s",
        authDomain: "agenda-4efa7.firebaseapp.com",
        projectId: "agenda-4efa7",
        storageBucket: "agenda-4efa7.appspot.com",
        messagingSenderId: "299659202964",
        appId: "1:299659202964:web:e358210feb4d7784f63f81"
   };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const messaging = firebase.messaging();

    // 2. L√ìGICA DO MENU DE CONFIGURA√á√ïES (Abas e Modal)
    function abrirModalConfig() {
      document.getElementById('modalConfiguracoes').style.display = 'block';
    }

    function fecharModalConfig() {
      document.getElementById('modalConfiguracoes').style.display = 'none';
    }

    // Fechar clicando fora do modal
    window.onclick = function(event) {
      const modal = document.getElementById('modalConfiguracoes');
      if (event.target == modal) { modal.style.display = "none"; }
    }

    function abrirAba(evt, nomeAba) {
      let i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) { tabcontent[i].style.display = "none"; }
      
      tablinks = document.getElementsByClassName("tablink");
      for (i = 0; i < tablinks.length; i++) { tablinks[i].className = tablinks[i].className.replace(" active", ""); }
      
      document.getElementById(nomeAba).style.display = "block";
      evt.currentTarget.className += " active";
    }

    // 3. L√ìGICA DO FILTRO DA SEMANA CORRIGIDO
    function filtrarTarefasPorSemana(tarefas) {
      const hoje = new Date();
      
      // Domingo, 00:00:00
      const primeiroDia = new Date(hoje);
      primeiroDia.setDate(hoje.getDate() - hoje.getDay());
      primeiroDia.setHours(0, 0, 0, 0);
      
      // S√°bado, 23:59:59
      const ultimoDia = new Date(primeiroDia);
      ultimoDia.setDate(primeiroDia.getDate() + 6);
      ultimoDia.setHours(23, 59, 59, 999);

      return tarefas.filter(tarefa => {
        // Assume que tarefa.data est√° num formato v√°lido, ex: "2026-02-28T14:30:00"
        const dataTarefa = new Date(tarefa.data); 
        return dataTarefa >= primeiroDia && dataTarefa <= ultimoDia;
      });
    }

    // Exemplo de uso para carregar tarefas (Simula√ß√£o)
    function carregarTarefas(filtro) {
      // Aqui entraria sua chamada db.collection('tarefas').get()...
      console.log("Carregando tarefas com o filtro:", filtro);
      if(filtro === 'semana') {
        // const tarefasDaSemana = filtrarTarefasPorSemana(tarefasDoBanco);
        // renderizar(tarefasDaSemana);
      }
    }

    // 4. REGISTRO DO SERVICE WORKER (Para Notifica√ß√µes com app fechado)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/firebase-messaging-sw.js')
      .then(function(registration) {
        console.log('Service Worker registrado com sucesso:', registration);
      }).catch(function(err) {
        console.log('Erro ao registrar Service Worker:', err);
      });
    }

    function solicitarPermissaoNotificacao() {
      Notification.requestPermission().then((permission) => {
        if (permission === 'granted') {
          console.log('Permiss√£o concedida.');
          // Obter o token para enviar as notifica√ß√µes
          messaging.getToken({ vapidKey: 'BDyyehg3466Bi3B_awzlWOcaXxwhRu1kC8O8KStXQrP6BWuAI2h_iZ8zkvI89-nO01NqriRqlxPKvevxktY5SI8' }).then((currentToken) => {
            if (currentToken) {
              console.log('Token gerado:', currentToken);
              // Salvar este token no Firestore atrelado ao usu√°rio
            }
          });
        } else {
          console.log('Permiss√£o negada.');
        }
      });
    }
  </script>
</body>
</html>